#!/bin/zsh

# Shortcuts
# =========

becho() { echo '\033[0;34m'$@'\033[0m' }
gecho() { echo '\033[0;32m'$@'\033[0m' }
recho() { echo '\033[0;31m'$@'\033[0m' }

# copy etc
# --------
cp_etc() {
    dir="$1"
    [[ ! -d "$DOTFILES/etc/$dir" ]] && return 1
    for file in $(find "$DOTFILES/etc/$dir" -type f); do
        sudo cp "$file" "${file#$DOTFILES}"
    done
}

# edit alias file
# ---------------
edit_alias() {
    if [[ $# -eq 0 ]]; then
        print_aliases
        return 1
    fi
    input_arg="$1"

    case "$input_arg" in
        g|global)
            alias_file="$GLOBAL_ALIAS"
            ;;
        l|local)
            alias_file="$LOCAL_ALIAS"
            ;;
        *)
            alias_file="$ALIASES/${input_arg}"
            ;;
    esac

    "$EDITOR" "$alias_file"
}
alias ea='edit_alias'

# remove alias file
# -----------------
remove_alias() {
    if [[ $# -eq 0 ]]; then
        print_aliases
        return 1
    fi

    input_arg="$1"
    case "$input_arg" in
        '-f')
            force=true
            shift
            ;;
        *)
            force=false
            ;;
    esac

    alias_file="$ALIASES/${1}"

    [[ -f "$alias_file" ]] || return 1

    # confirm with user if 'force' flag not provided
    if [[ "$force" = false ]]; then
        echo -n "Remove $alias_file (y/n)? "
        read choice
       
        if ! echo "$choice" | grep -iq "^y"; then
            return 1
        fi
    fi

    rm -f "$alias_file"
}
alias ra='remove_alias'

# source alias file
# -----------------
source_alias() {
    # if no input, print list of possible inputs and return
    if [[ $# -eq 0 ]]; then
        print_aliases
        return 1
    fi
    # check input(s), source associated alias file(s) accordingly
    input_arg="$1"
    shift
    case "$input_arg" in
        g|global)
            alias_file="$GLOBAL_ALIAS"
            ;;
        l|local)
            alias_file="$LOCAL_ALIAS"
            ;;
        *)
            alias_file="$ALIASES/${input_arg}"
            ;;
    esac
    if [[ -f "$alias_file" ]]; then
        echo "sourcing $alias_file"
        source "$alias_file"
    fi
    [[ $# -gt 0 ]] && source_alias $@
}
alias sa='source_alias'

### print alias file options (helper for {source,edit}_alias)
print_aliases() {
        echo "options:"
        echo "  - global (g)"
        echo "  - local (l)"
        ls -lh "$ALIASES" | tail -n +2 | awk '{ print $9 }'
}

# general git (more in git_aliases)
# ---------------------------------
alias gc='git commit -m'
alias gca='git commit -a'
alias gcam='git commit -am'
alias gs='git status'
alias gl="git log --pretty=format:'%C(auto)%h %ad %C(green)%s%Creset %C(auto)%d [%an]' --graph --date=format:'%Y-%m-%d %H:%M' --all"

alias gco='git checkout'

# Task Warrior
# ============

alias ta='unbuffer task active | sed \$d'

# Source additional aliases
# =========================
source_alias 'wenv' > /dev/null
source_alias 'ipfs' > /dev/null
